<div class="theme-toggle-container">
  <button
    class="theme-toggle-btn"
    onclick="cycleTheme()"
    aria-label="Toggle theme"
    title="Change theme"
  >
    <span class="theme-icon" id="theme-icon">‚òÄÔ∏è</span>
  </button>

  <div class="theme-dropdown">
    <button
      class="theme-option"
      onclick="setTheme('light')"
      aria-label="Switch to light theme"
    >
      <span class="theme-icon">‚òÄÔ∏è</span> Light
    </button>
    <button
      class="theme-option"
      onclick="setTheme('dark')"
      aria-label="Switch to dark theme"
    >
      <span class="theme-icon">üåô</span> Dark
    </button>
    <button
      class="theme-option"
      onclick="setTheme('auto')"
      aria-label="Switch to auto theme"
    >
      <span class="theme-icon">üíª</span> Auto
    </button>
  </div>
</div>

<script>
  // Function to get the current theme from localStorage or system preference
  function getCurrentTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) return savedTheme;

    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    return prefersDark ? 'dark' : 'light';
  }

  // Function to apply the theme to the document
  function applyTheme(theme: any) {
    const html = document.documentElement;

    // Remove all theme classes
    html.classList.remove('light', 'dark');

    if (theme === 'dark') {
      html.classList.add('dark');
      html.style.colorScheme = 'dark';
    } else if (theme === 'light') {
      html.classList.add('light');
      html.style.colorScheme = 'light';
    } else { // auto
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (prefersDark) {
        html.classList.add('dark');
        html.style.colorScheme = 'dark';
      } else {
        html.classList.add('light');
        html.style.colorScheme = 'light';
      }
    }

    // Update the icon in the main button
    const iconElement = document.getElementById('theme-icon');
    if (iconElement) {
      if (theme === 'dark') {
        iconElement.textContent = 'üåô';
      } else if (theme === 'auto') {
        iconElement.textContent = 'üíª';
      } else {
        iconElement.textContent = '‚òÄÔ∏è';
      }
    }
  }

  // Function to set the theme
  function setTheme(theme: any) {
    localStorage.setItem('theme', theme);
    applyTheme(theme);
  }

  // Function to cycle through themes
  function cycleTheme() {
    const current = getCurrentTheme();
    let nextTheme;

    if (current === 'light') {
      nextTheme = 'dark';
    } else if (current === 'dark') {
      nextTheme = 'auto';
    } else {
      nextTheme = 'light';
    }

    setTheme(nextTheme);
  }

  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', function() {
    const initialTheme = getCurrentTheme();
    applyTheme(initialTheme);

    // Listen for system theme changes when in auto mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (getCurrentTheme() === 'auto') {
        applyTheme('auto');
      }
    });
  });
</script>

<style>
  .theme-toggle-container {
    position: relative;
    display: inline-block;
  }

  .theme-toggle-btn {
    background: var(--sl-color-gray-3);
    border: 1px solid var(--sl-color-gray-4);
    border-radius: 9999px;
    padding: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 1.2rem;
  }

  .theme-toggle-btn:hover {
    background: var(--sl-color-gray-4);
    transform: scale(1.05);
  }

  .theme-dropdown {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    background: var(--sl-color-gray-2);
    border: 1px solid var(--sl-color-gray-4);
    border-radius: 0.5rem;
    padding: 0.5rem;
    min-width: 120px;
    box-shadow: 0 4px 6px var(--sl-color-gray-5);
    display: none;
    z-index: 100;
    flex-direction: column;
    gap: 0.25rem;
  }

  .theme-toggle-container:hover .theme-dropdown {
    display: flex;
  }

  .theme-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    text-align: left;
    font-size: 0.9rem;
    transition: background 0.2s ease;
  }

  .theme-option:hover {
    background: var(--sl-color-gray-3);
  }

  .theme-option.active {
    background: var(--sl-color-accent-low);
    color: var(--sl-color-accent-high);
  }

  .theme-icon {
    font-size: 1rem;
  }
</style>